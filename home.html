<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒ›ãƒ¼ãƒ  - åœ¨åº«ç®¡ç†</title>
  <link rel="stylesheet" href="header.css" />
  <link rel="stylesheet" href="home.css" />

  <!-- Firebase SDKï¼ˆäº’æ›ãƒ¢ãƒ¼ãƒ‰ï¼‰ -->
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCqPckkK9FkDkeVrYjoZQA1Y3HuOGuUGwI",
      authDomain: "inventory-app-312ca.firebaseapp.com",
      projectId: "inventory-app-312ca",
      storageBucket: "inventory-app-312ca.appspot.com",
      messagingSenderId: "245219344089",
      appId: "1:245219344089:web:e46105927c302e6a5788c8"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
</head>
<body>

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ -->
  <div id="headerContainer"></div>

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼èª­ã¿è¾¼ã¿ã¨ãƒ­ã‚¸ãƒƒã‚¯çµ±åˆ -->
  <script>
    fetch("header.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("headerContainer").innerHTML = html;

        // ãƒ˜ãƒƒãƒ€ãƒ¼åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯
        const auth = firebase.auth();
        const db = firebase.firestore();

        const responsibleUser = document.getElementById("responsibleUser");
        const lastJudgment = document.getElementById("lastJudgment");
        const clock = document.getElementById("clock");
        const adminMenuItem = document.getElementById("adminMenuItem");

        function toggleMenu() {
          const menu = document.getElementById("headerMenu");
          if (menu) {
            menu.style.display = menu.style.display === "none" ? "block" : "none";
          }
        }

        function closeMenu(event) {
          if (event.target.tagName !== "A") {
            const menu = document.getElementById("headerMenu");
            if (menu) menu.style.display = "none";
          }
        }

        function goHome() {
          window.location.href = "home.html";
        }

        function logout() {
          auth.signOut().then(() => {
            alert("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ");
            window.location.href = "index.html";
          }).catch((error) => {
            console.error("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¤±æ•—:", error);
            alert("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ");
          });
        }

        function updateClock() {
          const now = new Date();
          const options = { month: "numeric", day: "numeric", weekday: "short", hour: "2-digit", minute: "2-digit", second: "2-digit" };
          const formatted = now.toLocaleString("ja-JP", options);
          if (clock) clock.textContent = `â± ç¾åœ¨ï¼š${formatted}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        auth.onAuthStateChanged(async (user) => {
          if (!user) {
            if (responsibleUser) responsibleUser.textContent = "ğŸ‘‘ ãƒ­ã‚°ã‚¤ãƒ³ä¸­ï¼šæœªå–å¾—";
            if (lastJudgment) lastJudgment.textContent = "ğŸ•’ æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³ï¼šæœªå–å¾—";
            return;
          }

          const uid = localStorage.getItem("uid");
          if (!uid) return;

          try {
            const userDoc = await db.collection("users").doc(uid).get();
            const userData = userDoc.data();
            const name = userData?.name || "ä¸æ˜";
            const role = userData?.role || "æœªè¨­å®š";

            if (responsibleUser) responsibleUser.textContent = `ğŸ‘‘ ${name}ï¼ˆ${role}ï¼‰`;
            if (role === "ç®¡ç†è€…" && adminMenuItem) {
              adminMenuItem.style.display = "block";
            }

            const logs = await db.collection("loginLogs")
              .where("uid", "==", uid)
              .orderBy("timestamp", "desc")
              .limit(1)
              .get();

            if (!logs.empty) {
              const log = logs.docs[0].data();
              const ts = new Date(log.timestamp);
              const formatted = ts.toLocaleString("ja-JP", { month: "numeric", day: "numeric", weekday: "short", hour: "2-digit", minute: "2-digit" });
              if (lastJudgment) lastJudgment.textContent = `ğŸ•’ æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³ï¼š${formatted}`;
            }
          } catch (err) {
            console.error("è²¬ä»»è€…æƒ…å ±å–å¾—å¤±æ•—:", err);
          }
        });

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ç™»éŒ²
        window.toggleMenu = toggleMenu;
        window.closeMenu = closeMenu;
        window.goHome = goHome;
        window.logout = logout;
      });
  </script>

  <!-- ãƒ›ãƒ¼ãƒ æœ¬ä½“ -->
  <main id="homeMain">
    <h2>ğŸ  ãƒ›ãƒ¼ãƒ </h2>

    <section>
      <h3>ğŸ“Š çŠ¶æ³ã‚µãƒãƒªãƒ¼</h3>
      <ul>
        <li>åœ¨åº«ã‚ã‚Šï¼šå•†å“C</li>
        <li>ä¸è¶³ï¼šå•†å“A</li>
        <li>å»ƒæ£„äºˆå®šï¼šå•†å“D</li>
      </ul>
    </section>

    <section>
      <h3>â³ æœŸé™ã®è¿‘ã„ã‚‚ã®</h3>
      <ul>
        <li>å•†å“Bï¼ˆæœ¬æ—¥ï¼‰</li>
        <li>å•†å“Cï¼ˆã‚ã¨1æ—¥ï¼‰</li>
        <li>å•†å“Fï¼ˆã‚ã¨1æ—¥ï¼‰</li>
      </ul>
    </section>

    <section>
      <h3>ğŸ“… æƒ…å ±ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h3>
      <ul>
        <li>ç™ºæ³¨æ—¥ï¼š10/01</li>
        <li>å•†å“Eï¼ˆ16:00ï¼‰</li>
        <li>å•†å“Fï¼šæœŸé™æ›´æ–°ï¼ˆæ˜æ—¥ï¼‰</li>
        <li>ãƒ•ãƒªãƒæ›´æ–°ï¼ˆæ˜æ—¥ï¼‰</li>
      </ul>
    </section>

    <section>
      <h3>âš ï¸ å¤šæ©Ÿèƒ½AIã®è­¦å‘Š</h3>
      <ul>
        <li>å•†å“Cï¼šã€Œåœ¨åº«ãŒå¿…è¦ã§ã™ã€</li>
        <li>å•†å“Fï¼šã€ŒæœŸé™ãŒè¿‘ã„ã§ã™ã€</li>
      </ul>
    </section>

    <section>
      <h3>ğŸ¤– AIåœ¨åº«ææ¡ˆ</h3>
      <table>
        <thead>
          <tr><th>å•†å“</th><th>çŠ¶æ³</th><th>ææ¡ˆ</th></tr>
        </thead>
        <tbody>
          <tr><td>å•†å“A</td><td>é©æœŸ</td><td>å‡ºå“ã¾ãŸã¯å€¤ä¸‹ã’</td></tr>
          <tr><td>å•†å“B</td><td>åœ¨åº«å°‘</td><td>å‡ºå“ã¾ãŸã¯å€¤ä¸‹ã’</td></tr>
          <tr><td>å•†å“C</td><td>åœ¨åº«ãªã—</td><td>ç™ºæ³¨ã¾ãŸã¯ææ¡ˆ</td></tr>
          <tr><td>å•†å“D</td><td>ä¸è¶³</td><td>ææ¡ˆã¾ãŸã¯ç™ºæ³¨</td></tr>
        </tbody>
      </table>
    </section>

    <section>
      <h3>ğŸ›ï¸ ãƒ•ãƒªãƒæƒ…å ±</h3>
      <ul>
        <li>å•†å“Bï¼šä¾¡æ ¼æ”¹ï¼ˆÂ¥1200ï¼‰</li>
        <li>å•†å“Cï¼šæœŸé™ï¼ˆ9/13ï¼‰</li>
        <li>å•†å“Fï¼šæœŸé™ï¼ˆ9/13ï¼‰</li>
      </ul>
    </section>
  </main>

</body>
</html>