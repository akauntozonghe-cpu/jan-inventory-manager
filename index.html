<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>è²¬ä»»è€…ãƒ­ã‚°ã‚¤ãƒ³</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .view { display: none; margin-top: 20px; }
    #logoutBtn { margin-top: 20px; }
  </style>
</head>
<body>
  <h2>è²¬ä»»è€…ç•ªå·ã§ãƒ­ã‚°ã‚¤ãƒ³</h2>
  <input type="text" id="responsibilityInput" placeholder="è²¬ä»»è€…ç•ªå·ã‚’å…¥åŠ›">
  <button onclick="handleLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>

  <div id="adminView" class="view">
    <h3>ğŸ”§ ç®¡ç†è€…ç”»é¢</h3>
    <p>åœ¨åº«ç®¡ç†ã‚„è²¬ä»»è€…ç™»éŒ²ãŒã§ãã¾ã™ã€‚</p>
  </div>

  <div id="userView" class="view">
    <h3>ğŸ“¦ ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»é¢</h3>
    <p>åœ¨åº«ã®é–²è¦§ã‚„ç™»éŒ²ãŒã§ãã¾ã™ã€‚</p>
  </div>

  <button id="logoutBtn" class="view" onclick="handleLogout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>

  <!-- âœ… Firebase CDNäº’æ›ç‰ˆ SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-firestore-compat.js"></script>

  <script>
    // âœ… Firebaseè¨­å®šï¼ˆãƒˆã•ã‚“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç”¨ï¼‰
    const firebaseConfig = {
      apiKey: "AIzaSyCqPckkK9FkDkeVrYjoZQA1Y3HuOGuUGwI",
      authDomain: "inventory-app-312ca.firebaseapp.com",
      databaseURL: "https://inventory-app-312ca-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "inventory-app-312ca",
      storageBucket: "inventory-app-312ca.firebasestorage.app",
      messagingSenderId: "245219344089",
      appId: "1:245219344089:web:e46105927c302e6a5788c8",
      measurementId: "G-TRH31MJCE3"
    };

    // âœ… åˆæœŸåŒ–
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
    async function handleLogin() {
      const input = document.getElementById("responsibilityInput").value.trim();
      if (!input) return alert("è²¬ä»»è€…ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

      try {
        const ref = db.collection("responsible-users").doc(input);
        const snap = await ref.get();

        if (!snap.exists) {
          alert("è©²å½“ã™ã‚‹è²¬ä»»è€…ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
          return;
        }

        const data = snap.data();
        sessionStorage.setItem("responsibilityNumber", input);

        if (data.role === "admin") {
          showView("adminView");
        } else {
          showView("userView");
        }
      } catch (err) {
        console.error("ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—:", err);
        alert("Firestoreæ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¾ãŸã¯è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
      }
    }

    // ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒ
    window.addEventListener("DOMContentLoaded", async () => {
      const saved = sessionStorage.getItem("responsibilityNumber");
      if (!saved) return;

      try {
        const ref = db.collection("responsible-users").doc(saved);
        const snap = await ref.get();
        if (!snap.exists) return;

        const data = snap.data();
        if (data.role === "admin") {
          showView("adminView");
        } else {
          showView("userView");
        }
      } catch (err) {
        console.warn("ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒå¤±æ•—:", err);
      }
    });

    // UIåˆ‡ã‚Šæ›¿ãˆ
    function showView(viewId) {
      document.getElementById("adminView").style.display = "none";
      document.getElementById("userView").style.display = "none";
      document.getElementById("logoutBtn").style.display = "block";
      document.getElementById(viewId).style.display = "block";
    }

    // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
    function handleLogout() {
      sessionStorage.clear();
      document.getElementById("adminView").style.display = "none";
      document.getElementById("userView").style.display = "none";
      document.getElementById("logoutBtn").style.display = "none";
      document.getElementById("responsibilityInput").value = "";
    }
  </script>
</body>
</html>